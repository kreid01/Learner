@page "/notes"
@using Learner.Client.DTOs
@using Learner.Client.Services
@using Learner.Shared.Models
@inject ITodoService TodoServices
@inject NavigationManager NavigationManager

<section class="d-grid grid-cols-3">
    @foreach (var todo in TodoServices.Todos)
    {
        Console.WriteLine("solo");
        var id = todo.Id;
        <div class="bg-yellow-200 relative rounded-md min-h-[20vh] w-72 xl:w-96 m-3">
            <div class="ml-3">
                @if(IsEditing == false) {
                <h1 class="font-bold text-2xl mt-2">@todo.Title</h1>
                <h3 class="">@todo.Description</h3>
                } else {
                     <MudTextField Label="Title" class="mx-2 mt-2" Variant="Variant.Text" 
                     @bind-Value="todo.Title"></MudTextField>
                        <MudTextField Label="Description" class="mx-2" Variant="Variant.Text"
                        @bind-Value="todo.Description"></MudTextField>
                }
                <div class="flex absolute bottom-0 w-72 xl:w-96 justify-between mt-auto">
                    <p class="text-gray-500 mt-5">@todo.CreatedDate?.Substring(0,10)</p>
                   
                    <MudButton class="mb-3" Variant="Variant.Outlined"
                    @onclick="(() => DeleteTodo((int)id))">Delete</MudButton>
                    @if(IsEditing == false) {

                        <MudButton class="mr-5 mb-3" Variant="Variant.Outlined"
                        @onclick="EditTodo">Edit</MudButton>
                    
                    } else {
                        <MudButton class="mr-5 mb-3" Variant="Variant.Outlined"
                        @onclick="(() => UpdatePost(todo))">Update</MudButton>
                    }
                </div>
            </div>
        </div>
    }
</section>


<div class="bg-gray-100 relative rounded-md min-h-[20vh] w-72 xl:w-96 m-3">
    <MudTextField Label="Title" class="mx-2 mt-2"
    Variant="Variant.Text" @bind-Value="todo.Title"></MudTextField>
    <MudTextField Label="Description" class="mx-2"
    Variant="Variant.Text" @bind-Value="todo.Description"></MudTextField>
   
    <MudButton class="position-absolute bottom-0 mb-3 mr-2 right-0"
    OnClick="HandlePost" Variant="Variant.Outlined">Create</MudButton>
</div>



@code {

    PostTodoDto todo = new();

    protected override async Task OnInitializedAsync()
    {

        await TodoServices.GetTodos();
    }

    [Parameter]
    public int? Id { get; set; }

    public bool IsEditing = false;

    void EditTodo() {
        IsEditing = true;
    }

    async Task HandlePost()
    {
        await TodoServices.PostTodo(todo);
    }

    async Task UpdatePost(Todos updateTodo) 
    {
        await TodoServices.UpdateTodo(updateTodo);
        IsEditing = false;
    }

    async Task DeleteTodo(int id)
    {
        await TodoServices.DeleteTodo((int)id);
    }
}
